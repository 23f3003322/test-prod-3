/* Minimal markdown to HTML - supports headings (#, ##), code blocks and basic bold/italics */
(function(){
  function escapeHtml(s){
    return s
      .replace(/&/g,"&amp;")
      .replace(/</g,"&lt;")
      .replace(/>/g,"&gt;");
  }
  window.marked = function(md){
    var html = md;
    // code blocks
    html = html.replace(/```([a-zA-Z0-9_-]+)?\n([\s\S]*?)```/g, function(_, lang, code){
      return '<pre><code class="language-'+(lang||'')+'">'+escapeHtml(code)+'</code></pre>';
    });
    // headings
    html = html.replace(/^(#{1,6})\s+(.*)$/gm, function(_, hashes, text){
      var level = hashes.length;
      return '<h'+level+'>'+text+'</h'+level+'>';
    });
    // bold
    html = html.replace(/\*\*(.+?)\*\*/g, '<strong>$1</strong>');
    // italic
    html = html.replace(/\*(.+?)\*/g, '<em>$1</em>');
    // paragraphs
    html = html.split(/\n{2,}/).map(function(block){
      if (/^<h\d+>/.test(block) || /^<\/?pre>/.test(block) || block.trim() === '') return block.trim();
      var t = block.trim().replace(/\n+/g, ' ');
      if (t.length === 0) return '';
      return '<p>'+t+'</p>';
    }).join('');
    return html;
  };
})();